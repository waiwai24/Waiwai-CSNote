# 图片隐写术

> **Steganography （Steg）**隐写术,就是将秘密隐藏到普通信息中进行传送

[TOC]

## 一.  常见隐写方法

### 1.1 插入隐藏

利用文件的特性和文件格式的冗余性，在不影响载体正常使用情况下，将秘密信息插入到载体中，且这种方法通常会导致载体文件大小发生变化。根据秘密信息插入的位置，又可以分为**追加插入法**和**前置插入法**

* 追加插入法

  * 最常用，最简单的一种，通常在文件末尾附加数据

  * 基本原理：对于Windows系统，根据文件后缀解析载体文件，大部分文件格式都有文件结束标志，在文件结束标志后的数据不会被解析，也不会影响载体文件的使用
* 前置插入法
  * 利用文件头部的冗余部分进行插入，并且不影响原始数据的使用效果

### 1.2 替换隐藏

通过修改载体文件的数据，将原始载体内不重要的数据替换成所要隐藏的信息。若只修改部分字节，人眼几乎无法发现原图像发生了变化。最常见的替换隐藏是**最低比特隐写（least significant bit）LSB**,通过修改区域内像素值的八位二进制的最低位，将信息隐藏在最低位



## 二. 文件头文件尾汇总

|       文件类型       |        文件头        |   文件尾    |  特征   |
| :------------------: | :------------------: | :---------: | :-----: |
|      JPEG (jpg)      |       FF D8 FF       |    FF D9    |  ÿØÿà   |
|      PNG (png)       |     89 50 4E 47      | AE 42 60 82 | .PNG... |
|      GIF (gif)       |     47 49 46 38      |    00 3B    | GIF89a  |
| Windows Bitmap (bmp) |        42 4D         |             |   BM    |
| Adobe Acrobat (pdf)  | 25 50 44 46 2D 31 2E |             |  %PDF   |



## 三. PNG文件格式及隐写方法

1.Fireworks

使用winhex打开文件时会看到文件头部中包含firework的标识，通过fireworks可以找到隐藏图片

使用场景：查看隐写的图片文件

2.Exif

Exif按照JPEG的规格在JPEG中插入一些图像/数字相机的信息数据以及缩略图像

图片右击属性，查看exif或查看详细信息，在相关选项卡中查找flag信息

3.Stegsolve

当两张jpg图片外观，大小，像素都基本相同时，可以考虑进行结合分析，即将两个文件的像素RGB值进行xor，add，sub等操作，看能否得到有用的信息，stegsolve可以方便的进行这些操作

使用场景：两张图片信息基本相同

4.LSB(最低有效位least significant bit)

LSB替换隐写基本思想是用嵌入的秘密信息取代载体图像的最低比特位，原来的7个高位平面与替代秘密信息的最低位平面组合成含隐藏信息的新图形

注意：用自带的画图工具转换图片后缀

（1）使用stegsolve

analyse-data extract-最低位为0-改变bit plane order

（2）使用zsteg工具

Linux下使用，更为方便

```cmd
zsteg filename
```

（3）wbstego4工具

解密通过lsb加密的图片（常用于.bmp或.pdf的图片)

（4）python脚本

（5）TweakPNG

tweakpng是一款png图像浏览工具，允许查看和修改一些png图像文件的元信息存储

使用场景：

* 文件头正常却无法打开文件，利用tweakpng修改CRC

* 有时CRC没有错，可能是图片的高度或宽度错误

（6）BFtools

使用场景：在Windows的cmd下，对加密过的图片文件进行解密

```cmd
bftools.exe decode braincopter 要解密的文件名 --output 输出文件名
bftools.exe run 上一步输出的文件
```

（7）SilentEye

使用场景：windows下打开silenteye工具（可以将文字或者文件隐藏到图片的解密工具），对加密的图片进行解密



（8）JPG图像加密

stegdetect工具探测加密方式 

Stegdetect程序主要用于分析JPEG文件。 因此用Stegdetect可以检测到通过JSteg、JPHide、OutGuess、Invisible Secrets、F5、appendX和Camouflage等这些隐写工具隐藏的信息

```cmd
stegdetect xxx.jpg
stegdetect -s 灵敏度 xxx.jpg
```


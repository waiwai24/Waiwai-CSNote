

# 文件操作与隐写

[TOC]



## 一. 文件类型识别

| 文件类型    | 后缀 | 文件头   | 文件尾 | 标志 |
| ----------- | ---- | -------- | ------ | ---- |
| ZIP Archive | .zip | 504B0304 | -      | PK   |
| RAR Archive | .rar | 52617221 | -      | RAR! |
| 7Z Archive  | .7z  | 377ABCAF | -      | 7z   |

### 1.1 file命令

原理：不同文件类型的文件头是不一样的

使用场景：不知道后缀名，无法打开文件,linux下使用

格式：

```cmd
file filename
```

### 1.2 010editor

使用场景：Windows下通过文件头信息判断文件类型

在notepad++里打开文件，在插件中选择hex-editor（或者010editor），查看十六进制的编码第一行文件头信息

### 1.3 文件头残缺/错误

利用file命令查看返回为data，无法看到文件类型，所以要用编辑器补充文件头



## 二. 文件分离操作

### 2.1 Binwalk工具

Linux下用来分析和分离文件的工具，可以快速分辨文件是否由多个文件合并而成，进而将文件分离。如果分离成功则会在目标文件夹的目录

```cmd
分析文件：
binwalk filename
分离文件：
binwalk -e filename
```

### 2.2 foremost

如果binwalk无法正确分离出文件，可以使用foremost

```cmd
foremost filename -o 输出目录名
```

### 2.3 dd

当文件自动分离出错或者因为其他原因无法自动分离时，可以使用dd实现文件手动分离

```cmd
dd if=源文件 of=目标文件名bs=1 skip=开始分离的字节数

if=file #输入文件名
of=file #输出文件名
bs=bytes #同时设置读写块的大小为bytes，可代替ibs和obs
skip=blocks #从输入文件开头跳过blocks个块后再开始复制
```

### 2.4 010editor

将某块区域选中并导出来/将十六进制字符文件保存在一个文件里，然后打开010editor并在文件里选择导入十六进制



## 三. 文件合并操作

> 为了隐藏重要数据，通过命令提示符来将两个文件合并成一个文件

完整性检测：计算文件md5，验证完整性(md5 值是一个128位的二进制数据，转换成16进制则是32位)

### 3.1 Linux下的文件合并

使用场景：通常对文件名相似的文件要进行批量合并

```cmd
md5sum filename#计算md5值
cat 合并的文件（中间用空格） > 输出的文件
```

### 3.2 Windows下的文件合并

```cmd
certutil -hashfile filename md5
copy /B 合并的文件（中间用加号） 输出的文件
```



## 四. 文件内容隐写

直接将key以十六进制的形式写在文件中，通常在文件的开头或结尾部分，如果在中间部分，通常搜索关键字key或flag来查找隐藏内容


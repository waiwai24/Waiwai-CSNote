# HTTP与HTTPS

[TOC]

## 1.二者区别

* HTTP信息是明文传输，存在安全风险问题，而HTTPS在TCP和HTTP网络层之间加入了SSL/TLS安全协议，使报文加密传输
* HTTP默认端口80，HTTPS默认端口443
* HTTPS协议需要向CA（证书权威机构）申请数字证书，来保证服务器身份是可信的



## 2.解决的风险

* 信息加密（混合加密）：

  * 采用对称加密和非对称加密结合的混合加密方式
  * 在通信建立前采用**非对称加密**的方式交换「会话秘钥」，后续就不再使用非对称加密。
  * 在通信过程中全部使用**对称加密**的「会话秘钥」的方式加密明文数据。

* 校验机制（摘要算法+数字签名）：

  ![](img/5.assets/摘要算法.webp)

  * 计算机里会采用摘要算法（哈希函数）计算出内容的哈希值，通过哈希算法确保内容不会被篡改
  * 但是并不能确保【内容+哈希值】不会被中间人替换，因为这里缺少客户端收到的信息是否来源于服务端的证明，为了避免这种情况你计算机会使用非对称加密算法来解决：
    * **公钥加密，私钥解密**。这个目的是为了**保证内容传输的安全**，因为被公钥加密的内容，其他人是无法解密的，只有持有私钥的人，才能解密出实际的内容；
    * **私钥加密，公钥解密**。这个目的是为了**保证消息不会被冒充**，因为私钥是不可泄露的，如果公钥能正常解密出私钥加密的内容，就能证明这个消息是来源于持有私钥身份的人发送的
  * 一般我们不会用非对称加密来加密实际的传输内容，因为非对称加密的计算比较耗费性能的。所以非对称加密的用途主要在于**通过「私钥加密，公钥解密」的方式，来确认消息的身份**，我们常说的**数字签名算法**，就是用的是这种方式，不过私钥加密内容不是内容本身，而是**对内容的哈希值加密**
  * 私钥是由服务端保管，然后服务端会向客户端颁发对应的公钥。如果客户端收到的信息，能被公钥解密，就说明该消息是由服务器发送的

  ![](img/5.assets/数字签名.webp)

* 身份证书（数字证书）：

  * 上面这些操作还不够，**缺少身份验证的环节**，万一公钥是被伪造的呢？

  ![](img/5.assets/22-数字证书工作流程.webp)



## 3.HTTPS建立连接

SSL/TLS 协议基本流程：

- 客户端向服务器索要并验证服务器的公钥
- 双方协商生产「会话秘钥」
- 双方采用「会话秘钥」进行加密通信

前两步也就是 SSL/TLS 的建立过程，也就是 TLS 握手阶段。

TLS 的「握手阶段」涉及**四次**通信，使用不同的密钥交换算法，TLS 握手流程也会不一样的，现在常用的密钥交换算法有两种：[RSA 算法 ](https://xiaolincoding.com/network/2_http/https_rsa.html)和 [ECDHE 算法](https://xiaolincoding.com/network/2_http/https_ecdhe.html)